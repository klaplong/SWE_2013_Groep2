{% extends "_base.html" %}
{% block content %}
<script language="javascript" type="text/javascript">
    var stdlimit = 10;
    var currPage = 1;
    var currentQuestionFilter = -1;
    var currentUserFilter = -1;

    $(document).ready(function() {
        $('#submit').click(function(){
            refresh_table_default();
            return false;
        });

        refresh_table_default();
    });

    function setfilteruser(userid,username){
        currentUserFilter = userid;
        $('a#userfiltertext').text(username)
        reload();
    }   

    function clearfilteruser(){
        currentUserFilter = -1;
        $('a#userfiltertext').text('Select User')
        reload();
    }

    function setfilterquestion(questid,questtext){
        currentQuestionFilter = questid;
        $('a#questionfiltertext').text(questtext.substring(10)+'...')
        reload();
    }   

    function clearfilterquestion(){
        currentQuestionFilter = -1;
        $('a#questionfiltertext').text('Select Question')
        reload();
    }
    function load_page(page){
        currPage = page;
        refresh_table((page-1)*stdlimit,stdlimit);
    }

    function refresh_table_default(){
        refresh_table(0,stdlimit);
    }

    function refresh_table(offset,limit){
        var dict = {offset:offset,limit:limit}

        if (currentUserFilter != -1){
            dict['userID'] = currentUserFilter;
        }

        if (currentQuestionFilter != -1){
            dict['questionID'] = currentQuestionFilter;
        }

        $.get('/filteranswerstbl',
            dict,
            function(data){
            $('#tblContainer').html(data);});
    }

    function reload(){
        load_page(currPage);
    }
</script>

<form method="POST" class="form-inline" id="answerfilter-form">
    <b>Filter by:</b><br>
    <label>UserID</label>
    <div class="btn-group">
        <a href='#' class="btn" id='userfiltertext'>Select user</a>
        <a class="btn dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
            <li><a href='#' onclick="clearfilteruser();">Clear</a></li>
            <li class='divider'></li>
            {% for user in users %}
            <li><a href='#' onclick="setfilteruser('{{user.userid}}','{{user.username}}');">{{user.username}}</a></li>
            {% endfor %}
        </ul>
    </div>

    {% if hasQuestionID%}
        <input type='hidden' id='questionID' value='{{ questionID }}' />
    {% else %}
        <label>QuestionID</label> 
        <div class="btn-group">
            <a href='#' class="btn" id='questionfiltertext'>Filter</a>
            <a href='#' class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                <li><a href='#' onclick="clearfilterquestion();">Clear</a></li>
                <li class='divider'></li>
                {% for question in questions %}
                <li><a href='#'
                    onclick="setfilterquestion('{{question.id}}','{{question.question}}');">{{question.question[:10]+'...'}}</a></li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <input id='submit' type="submit" value="Search" class="btn btn-primary" />
</form>
<div id='tblContainer'></div>
{% endblock %}
